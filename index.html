<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./src/styles/main.css" />
    <link rel="icon" type="image/png" href="./images/favicon.png">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>HeroHistory</title>

</head>
<style>
    svg {
        fill: orange;
    }

    svg text {
        fill:white;
        font: 10px sans-serif;
        text-anchor: end;
    }

    .bar {
        fill: steelblue;
    }
</style>

<body>
    <script src="./dist/main.js"></script>
    <img class="logo" src="./images//favicon.png">
    <h1 class="title">Welcome to HeroHistory!</h1>
    <div id="donut">
        <svg id="donut-svg"></svg>
    </div>
    <button>Year-By-Year Breakdown (Marvel)</button>
    <!-- <svg id="svg2" width="1200" height="900"></svg> -->

    <script>
        const total = [
            {
                title: "Male",
                count: 85023
            },
            {
                title: "Female",
                count: 37762
            },
            {
                title: "Other",
                count: 16626
            }]

        const height = 360;
        const width = 360;
        const radius = Math.min(width, height) / 2;
        const donutWidth = 75;
        const color = d3.scaleOrdinal(d3.schemeCategory10);

        const svg = d3.select('#donut-svg')
            // .append(svg)
            .attr('width', width)
            .attr('height', height)
            .append('g')
            .attr('transform', 'translate(' + (width / 2) + "," + (height / 2) + ')')

        const arc = d3.arc()
            .innerRadius(radius - donutWidth)
            .outerRadius(radius);

        const pie = d3.pie()
            // .startAngle(1.1 * Math.PI)
            // .endAngle(3.1 * Math.PI)
            .value(function (d) {
                return d.count
            })
            .sort(null);
        
        const donutTip = d3.select("body").append("div")
            .attr("class", "donut-tip")
            .style("opactiy", 0)

        const path = svg.selectAll('path')
            .data(pie(total))
            .enter()
            .append('path')
            .attr('d', arc)
            .attr('fill', function (d, i) {
                return color(d.data.title)
            })
            .attr('transform', 'translate(0,0)')
            .on("mouseover", onMouseOver)
            .on("mouseout", onMouseOut);

        function onMouseOver(d,i) {
            d3.select(this).transition()
            .duration('50')
            .attr('opacity', '.85')
            donutTip.transition()
            .duration(50)
            .style("opacity", 1)
            let num = (Math.round((d.data.count/140000) * 100)).toString() + "%"
            donutTip.html(num)
                .style("left", (d3.event.pageX + 10) + "px")
                .style("top", (d3.event.pageY - 15) + "px")
        }

        function onMouseOut(d,i) {
            d3.select(this).transition()
                .duration('50')
                .attr('opacity', 1)
            donutTip.transition()
                .duration('50')
                .style('opacity', 0)
        }

        const legendRectSize = 13;
        const legendSpacing = 7;
        
        const legend = svg.selectAll('.legend')
            .data(color.domain())
            .enter()
            .append('g')
            .attr('class', 'circle-legend')
            .attr('transform', function (d,i) {
                let height = legendRectSize + legendSpacing;
                let offset = height * color.domain().length/2;
                let horizontal = -2 * legendRectSize - 13;
                let vertical = i * height-offset;
                return 'translate(' + horizontal + ',' + vertical + ')';
            })
        
        legend.append('circle')
            .style('fill', color)
            .style('stroke', color)
            .attr('cx', 0)
            .attr('cy', 0)
            .attr('r', '.5rem')

        legend.append('text')
            .attr('x', legendRectSize + legendSpacing)
            .attr('y', legendRectSize - legendSpacing)
            .text(function (d) {
                return d;
            })


            
    </script>




    <!-- <script>
        const svg2 = d3.select("#svg2"),
                margin = 200,
                width2 = svg2.attr("width") - margin,
                height2 = svg2.attr("height") - margin;


        const xScale = d3.scaleBand().range([0, width]).padding(0.6),
              yScale = d3.scaleLinear().range([height2, 0]);

        const g = svg2.append("g")
            .attr("transform", "translate(" + 100 + "," + 100 + ")");

        d3.csv("./data/yearData.csv").then(function (data) {
            xScale.domain(data.map(function (d) { return d.year; }));
            yScale.domain([0, d3.max(data, function (d) { return d.issues; })]);

            g.append("g")
                .attr("transform", "translate(0," + height2 + ")")
                .call(d3.axisBottom(xScale))
                .append("text")
                .attr("y", height2 - 250)
                .attr("x", width2 - 100)
                .attr("text-anchor", "end")
                .attr("stroke", "black")
                .text("Year");
            
            g.append("g")
                .call(d3.axisLeft(yScale)
                    .tickFormat(function (d) {
                        return d;
                    }).ticks(15))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "-5.1em")
                .attr("text-anchor", "end")
                .attr("stroke", "black")
                .text("(Unique) issues released");

            svg2.append("text")
                .attr("transform", "translate(100,0)")
                .attr("x", 50)
                .attr("y", 50)
                .attr("font-size", "24px")
                .text("# of releases (Marvel)")

                g.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .on("mouseover", onMouseOver)
                .on("mouseout", onMouseOut)
                .attr("x", function (d) { return xScale(d.year); })
                .attr("y", function (d) { return yScale(0); })
                .attr("width", xScale.bandwidth())
                .attr("height", function (d) { return height2 - yScale(0); });

            svg2.selectAll("rect")
                .transition()
                .duration(1200)
                .attr("y", function(d) { return yScale(d.issues)})
                .attr("height", function(d) { return height2 - yScale(d.issues)})
                .delay(function(d,i){return(i*13)})
        });

        function onMouseOver(d, i) {
                d3.select(this).attr('class', 'highlight');
                d3.select(this)
                    .transition()    
                    .duration(400)
                    .attr('width', xScale.bandwidth() + 2)
                    .attr("y", function (d) { return yScale(d.issues) - 10; })
                    .attr("height", function (d) { return height2 - yScale(d.issues) + 10; });

                g.append("text")
                    .attr('class', 'val')
                    .attr('x', function () {
                        return xScale(d.year) - 5;
                    })
                    .attr('y', function () {
                        return yScale(d.issues) - 15;
                    })
                    .text(function () {
                        return [d.issues]; 
                    });
            }

        function onMouseOut(d, i) {
                d3.select(this).attr('class', 'bar');
                d3.select(this)
                    .transition()     
                    .duration(400)
                    .attr('width', xScale.bandwidth())
                    .attr("y", function (d) { return yScale(d.issues); })
                    .attr("height", function (d) { return height2 - yScale(d.issues); });

                d3.selectAll('.val')
                    .remove()
            }

    </script> -->

</body>
</html>