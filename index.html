<!-- citing all data -->
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="./src/styles/main.css" />
    <link rel="icon" type="image/png" href="./images/favicon.png">
    <script src="https://d3js.org/d3.v5.min.js"></script>
    <title>HeroHistory</title>

</head>
<style>
    svg {
        fill: orange;
    }

    svg text {
        fill:black;
        font: 10px sans-serif;
        text-anchor: end;
    }

    .bar {
        fill: steelblue;
    }
</style>

<body>
    <script src="./dist/main.js"></script>
    <div class="header-bar">
        <img class="logo" src="./images//favicon.png">
    </div>
    <div>
        <button>Year-By-Year Breakdown (Marvel)</button>
    </div>
    <div id="donut">
        <svg id="donut-svg"></svg>
    </div>
    <div id="bubble"></div>
    <svg id="svg2" width="1200" height="900"></svg>

    <script>
        const total = [
            {
                title: "Male",
                count: 85023
            },
            {
                title: "Female",
                count: 37762
            },
            {
                title: "Other",
                count: 16626
            }]

        const height = 360;
        const width = 360;
        const radius = Math.min(width, height) / 2;
        const donutWidth = 75;
        const color = d3.scaleOrdinal(d3.schemeCategory10);

        const svg = d3.select('#donut-svg')
            // .append(svg)
            .attr('width', width)
            .attr('height', height)
            .append('g')
            .attr('transform', 'translate(' + (width / 2) + "," + (height / 2) + ')')

        const arc = d3.arc()
            .innerRadius(radius - donutWidth)
            .outerRadius(radius);

        const pie = d3.pie()
            .value(function (d) {
                return d.count
            })
            .sort(null);
        
        const donutTip = d3.select("body").append("div")
            .attr("class", "donut-tip")
            .style("opactiy", 0)

        const path = svg.selectAll('path')
            .data(pie(total))
            .enter()
            .append('path')
            .attr('d', arc)
            .attr('fill', function (d, i) {
                return color(d.data.title)
            })
            .on("mouseover", onMouseOver)
            .on("mouseout", onMouseOut)
            .attr('transform', 'translate(0,0)')
            .transition()
            .ease(d3.easeLinear)
            .duration(1700)
            .attrTween("d", tweenPie)

        svg.append("text")
                .attr("transform", "translate(100,0)")
                .attr("x", -25)
                .attr("y", 50)
                .attr("font-size", "24px")
                .text("Character gender (All Publishers)")
      
        function tweenPie(b) {
            const i = d3.interpolate({ startAngle: 1.1 * Math.PI, endAngle: 1.1 * Math.PI }, b);
            return function (t) { return arc(i(t)); };
        }

        function onMouseOver(d,i) {
            d3.select(this).transition()
            .duration('50')
            .attr('opacity', '.85')
            donutTip.transition()
            .duration(50)
            .style("opacity", 1)
            let num = (Math.round((d.data.count/140000) * 100)).toString() + "%"
            donutTip.html(num)
                .style("left", (d3.event.pageX + 10) + "px")
                .style("top", (d3.event.pageY - 15) + "px")
        }

        function onMouseOut(d,i) {
            d3.select(this).transition()
                .duration('50')
                .attr('opacity', 1)
            donutTip.transition()
                .duration('50')
                .style('opacity', 0)
        }

        const legendRectSize = 10;
        const legendSpacing = 11;
        
        const legend = svg.selectAll('.legend')
            .data(color.domain())
            .enter()
            .append('g')
            .attr('class', 'circle-legend')
            .attr('transform', function (d,i) {
                let height = legendRectSize + legendSpacing;
                let offset = height * color.domain().length/2;
                let horizontal = -2 * legendRectSize - 13;
                let vertical = i * height-offset;
                return 'translate(' + horizontal + ',' + vertical + ')';
            })
        
        legend.append('circle')
            .style('fill', color)
            .style('stroke', color)
            .attr('cx', 0)
            .attr('cy', 0)
            .attr('r', '.5rem')

        legend.append('text')
            .attr('x', legendRectSize + legendSpacing + 25)
            .attr('y', legendRectSize - legendSpacing + 3)
            .text(function (d) {
                return d;
            })
    </script>




    <script>
        const svg2 = d3.select("#svg2"),
                margin = 150,
                width2 = svg2.attr("width") - margin,
                height2 = svg2.attr("height") - margin;


        const xScale = d3.scaleBand().range([0, width2]).padding(0.6),
              yScale = d3.scaleLinear().range([height2, 0]);

        const g = svg2.append("g")
            .attr("transform", "translate(" + 100 + "," + 100 + ")");

        d3.csv("./data/yearData.csv").then(function (data) {
            xScale.domain(data.map(function (d) { return d.year; }));
            yScale.domain([0, 1300]);

            g.append("g")
                .attr("transform", "translate(0," + height2 + ")")
                .call(d3.axisBottom(xScale))
                .append("text")
                .attr("y", height2 - 200)
                .attr("x", width2 - 100)
                .attr("text-anchor", "end")
                .attr("stroke", "black")
                .text("Year");
            
            g.append("g")
                .call(d3.axisLeft(yScale)
                    .tickFormat(function (d) {
                        return d;
                    }).ticks(10))
                .append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 6)
                .attr("dy", "-5.1em")
                .attr("text-anchor", "end")
                .attr("stroke", "black")
                .text("(Unique) issues released");

            svg2.append("text")
                .attr("transform", "translate(100,0)")
                .attr("x", 50)
                .attr("y", 50)
                .attr("font-size", "24px")
                .text("# of releases (Marvel)")

                g.selectAll(".bar")
                .data(data)
                .enter().append("rect")
                .attr("class", "bar")
                .on("mouseover", onMouseOver)
                .on("mouseout", onMouseOut)
                .attr("x", function (d) { return xScale(d.year); })
                .attr("y", function (d) { return yScale(0); })
                .attr("width", xScale.bandwidth())
                .attr("height", function (d) { return height2 - yScale(0); });

            svg2.selectAll("rect")
                .transition()
                .duration(1200)
                .attr("y", function(d) { return yScale(d.issues)})
                .attr("height", function(d) { return height2 - yScale(d.issues)})
                .delay(function(d,i){return(i*13)})
        });

        function onMouseOver(d, i) {
                d3.select(this).attr('class', 'highlight');
                d3.select(this)
                    .transition()    
                    .duration(400)
                    .attr('width', xScale.bandwidth() + 2)
                    .attr("y", function (d) { return yScale(d.issues) - 10; })
                    .attr("height", function (d) { return height2 - yScale(d.issues) + 10; });

                g.append("text")
                    .attr('class', 'val')
                    .attr('x', function () {
                        return xScale(d.year) + 10;
                    })
                    .attr('y', function () {
                        return yScale(d.issues) - 20;
                    })
                    .text(function () {
                        return [d.issues]; 
                    });
            }

        function onMouseOut(d, i) {
                d3.select(this).attr('class', 'bar');
                d3.select(this)
                    .transition()     
                    .duration(400)
                    .attr('width', xScale.bandwidth())
                    .attr("y", function (d) { return yScale(d.issues); })
                    .attr("height", function (d) { return height2 - yScale(d.issues); });

                d3.selectAll('.val')
                    .remove()
            }

    </script>

    <script>
    dataset = {
    "children": [{
    "title": "Avengers: Endgame",
    "studio": "Marvel/Disney",
    "boxOffice": 2797800564,
    },
    {
    "title": "Avengers: Infinity War",
    "studio": "Marvel/Disney",
    "boxOffice": 2048359754
    },
    {
    "title": "The Avengers",
    "studio": "Marvel/Disney",
    "boxOffice": 1518812988
    },
    {
    "title": "Avengers: Age of Ultron",
    "studio": "Marvel/Disney",
    "boxOffice": 1405403694
    },
    {
    "title": "Black Panther",
    "studio": "Marvel/Disney",
    "boxOffice": 1346913171
    },
    {
    "title": "Incredibles 2",
    "studio": "Disney/Pixar",
    "boxOffice": 1242805359
    },
    {
    "title": "Iron Man 3",
    "studio": "Marvel/Disney",
    "boxOffice": 1214811252
    },
    {
    "title": "Captain America: Civil War",
    "studio": "Marvel/Disney",
    "boxOffice": 1153304495
    },
    {
    "title": "Aquaman",
    "studio": "DC/Warner Bros.",
    "boxOffice": 2048359754
    },
    {
    "title": "Spider-Man: Far From Home",
    "studio": "Marvel/Sony",
    "boxOffice": 1131927996
    },
    {
    "title": "Captain Marvel",
    "studio": "Marvel/Disney",
    "boxOffice": 1128274794
    },
    {
    "title": "The Dark Knight Rises",
    "studio": "DC/Warner Bros.",
    "boxOffice": 1081041287
    },
    {
    "title": "Joker",
    "studio": "DC/Warner Bros.",
    "boxOffice": 1074251311
    },
    {
    "title": "The Dark Knight",
    "studio": "DC/Warner Bros.",
    "boxOffice": 1004558444
    },
    {
    "title": "Spider-Man 3",
    "studio": "Marvel/Sony",
    "boxOffice": 890871626
    },
    {
    "title": "Spider-Man: Homecoming",
    "studio": "Marvel/Sony",
    "boxOffice": 880166924
    },
    {
    "title": "Batman v. Superman: Dawn of Justice",
    "studio": "DC/Warner Bros.",
    "boxOffice": 873634919
    },
    {
    "title": "Guardians of the Galaxy Vol. 2",
    "studio": "Marvel/Disney",
    "boxOffice": 863756051
    },
    {
    "title": "Venom",
    "studio": "Marvel/Sony",
    "boxOffice": 856085151
    },
    {
    "title": "Thor: Ragnarok",
    "studio": "Marvel/Disney",
    "boxOffice": 853977126
    },
    {
    "title": "Wonder Woman",
    "studio": "DC/Warner Bros.",
    "boxOffice": 863756051
    },
    {
    "title": "Spider-Man",
    "studio": "Marvel/Sony",
    "boxOffice": 821708551
    },
    {
    "title": "Spider-Man 2",
    "studio": "Marvel/Sony",
    "boxOffice": 788976453
    },
    {
    "title": "Deadpool 2",
    "studio": "Marvel/20th Century Fox",
    "boxOffice": 785046920
    },
    {
    "title": "Deadpool",
    "studio": "Marvel/20th Century Fox",
    "boxOffice": 783112979
    },
    
    ]
    }
    
    const diameter = 900;
    const color2 = d3.scaleOrdinal(d3.schemeCategory10);
    
    default_height = 650;
    default_ratio = diameter / default_height;
    

    function set_size() {
    current_width = window.innerWidth;
    current_height = window.innerHeight;
    current_ratio = current_width / current_height;

    if (current_ratio > default_ratio) {
    let diameter = 1200;
    } else {
    let diameter = 600;
    }
    };
    set_size();
    
    const bubble = d3.pack(dataset)
    .size([diameter, diameter])
    .padding(.9);
    
    const svg3 = d3.select("#bubble")
    .append("svg")
    .attr("width", diameter)
    .attr("height", diameter)
    .attr("class", "bubble");
    
    const nodes = d3.hierarchy(dataset)
    .sum(function (d) {
    return d.boxOffice;
    });
    
    
    const node = svg3.selectAll(".node")
    .data(bubble(nodes).descendants())
    .enter()
    .filter(function (d) {
    return !d.children
    })
    .append("g")
    .on('mouseover', function (d, i) {
    d3.select(this).transition()
    .duration('100')
    .attr('opacity', '.7');
    })
    .on('mouseout', function (d, i) {
    d3.select(this).transition()
    .duration('100')
    .attr('opacity', '1');
    })
    .attr("class", "node")
    .attr("transform", function (d) {
    return "translate(" + d.x + "," + d.y + ")";
    });
    
    node.append("title")
    .text(function (d) {
    return d.title;
    });

    node.append("studio")
    .text(function (d) {
    return d.studio;
    });
    
    node.append("circle")
    .attr("r", function (d) {
    return d.r;
    })
    .style("fill", function (d, i) {
    return color2(i);
    });
    
    node.append("text")
    .attr("dy", ".03em")
    .style("text-anchor", "middle")
    .text(function (d) {
    return d.data.title;
    })
    .attr("font-size", function (d) {
    return d.r / 5;
    })
    .attr("fill", "white");

    
    node.append("text")
    .attr("dy", "1.3em")
    .style("text-anchor", "middle")
    .text(function (d) {
    return "$" + d.data.boxOffice.toString().replace(/(\d)(?=(\d{3})+(?!\d))/g, '$1,');
    })
    .attr("font-size", function (d) {
    return d.r / 5;
    })
    .attr("fill", "white");
    
    d3.select(self.frameElement)
    .style("height", diameter + "px");

    

</script>

</body>
</html>